#!/bin/bash

# é‚®ä»¶ç¼–ç æµ‹è¯•è„šæœ¬
# æµ‹è¯•ä¿®å¤åçš„é‚®ä»¶å‘é€æ˜¯å¦æ”¯æŒUTF-8ç¼–ç 

echo "=========================================="
echo "ğŸ“§ é‚®ä»¶ç¼–ç æµ‹è¯•è„šæœ¬"
echo "=========================================="

# è®¾ç½®UTF-8ç¼–ç ç¯å¢ƒ
export LANG=zh_CN.UTF-8
export LC_ALL=zh_CN.UTF-8

echo "ğŸ” å½“å‰ç¼–ç ç¯å¢ƒï¼š"
echo "LANG: $LANG"
echo "LC_ALL: $LC_ALL"
echo ""

# æµ‹è¯•é‚®ä»¶å†…å®¹ï¼ˆåŒ…å«ä¸­æ–‡å’Œemojiï¼‰
TEST_SUBJECT="ğŸ“Š é‚®ä»¶ç¼–ç æµ‹è¯• - $(date '+%Y-%m-%d %H:%M:%S')"
TEST_BODY="ğŸ“§ JMeteré‚®ä»¶ç¼–ç æµ‹è¯•

ğŸ• æµ‹è¯•æ—¶é—´: $(date '+%Y-%m-%d %H:%M:%S')
ğŸ“ˆ æµ‹è¯•ç›®çš„: éªŒè¯UTF-8ç¼–ç æ”¯æŒ
ğŸ“Š æµ‹è¯•å†…å®¹:
   â€¢ ä¸­æ–‡å­—ç¬¦æ˜¾ç¤ºæµ‹è¯•
   â€¢ Emojiè¡¨æƒ…ç¬¦å·æµ‹è¯•: ğŸ“§ ğŸ“Š ğŸ• ğŸ“ˆ ğŸ“ âœ… âš ï¸ âŒ
   â€¢ ç‰¹æ®Šå­—ç¬¦æµ‹è¯•: Â¥ â‚¬ Â£ Â© Â® â„¢

ğŸ¯ æµ‹è¯•ç»“æœ: å¦‚æœæ‚¨èƒ½æ­£å¸¸çœ‹åˆ°ä»¥ä¸Šæ‰€æœ‰å­—ç¬¦ï¼Œè¯´æ˜UTF-8ç¼–ç ä¿®å¤æˆåŠŸï¼

---
JMeterè‡ªåŠ¨åŒ–æµ‹è¯•ç³»ç»Ÿç¼–ç æµ‹è¯•
"

echo "ğŸ“ æµ‹è¯•é‚®ä»¶å†…å®¹ï¼š"
echo "ä¸»é¢˜: $TEST_SUBJECT"
echo "æ­£æ–‡:"
echo "$TEST_BODY"
echo ""

# åˆ›å»ºæµ‹è¯•ZIPæ–‡ä»¶
TEST_ZIP="/tmp/encoding_test_$(date +%s).zip"
echo "æµ‹è¯•UTF-8ç¼–ç æ”¯æŒ" > "/tmp/test_content.txt"
zip -q "$TEST_ZIP" "/tmp/test_content.txt"

echo "ğŸ“¦ åˆ›å»ºæµ‹è¯•é™„ä»¶: $TEST_ZIP"
echo ""

# æµ‹è¯•ä¿®å¤åçš„é‚®ä»¶å‘é€è„šæœ¬
echo "ğŸš€ æµ‹è¯•ä¿®å¤åçš„é‚®ä»¶å‘é€è„šæœ¬..."
echo ""

if [ -f "send-email-with-attachment.sh" ]; then
    echo "ğŸ“§ æ‰§è¡Œsend-email-with-attachment.shæµ‹è¯•..."
    ./send-email-with-attachment.sh "TEST" "/dev/null" "/dev/null" "$TEST_ZIP"
else
    echo "âŒ send-email-with-attachment.sh ä¸å­˜åœ¨"
fi

echo ""
echo "=========================================="
echo "ğŸ“Š æµ‹è¯•å®Œæˆ"
echo "=========================================="
echo "ğŸ’¡ æ£€æŸ¥è¦ç‚¹ï¼š"
echo "â€¢ æŸ¥çœ‹é‚®ä»¶å‘é€æ—¥å¿—ä¸­æ˜¯å¦æ˜¾ç¤º'UTF-8ç¼–ç '"
echo "â€¢ ç¡®è®¤ä½¿ç”¨äº†Pythonè„šæœ¬è€Œéç³»ç»Ÿmailå‘½ä»¤"
echo "â€¢ æ£€æŸ¥æ˜¯å¦é¿å…äº†é‡å¤å‘é€"
echo ""
echo "ğŸ“§ å¦‚æœæ”¶åˆ°æµ‹è¯•é‚®ä»¶ï¼Œè¯·æ£€æŸ¥ï¼š"
echo "â€¢ ä¸­æ–‡å­—ç¬¦æ˜¯å¦æ­£å¸¸æ˜¾ç¤º"
echo "â€¢ Emojiè¡¨æƒ…æ˜¯å¦æ­£ç¡®æ˜¾ç¤º"
echo "â€¢ æ˜¯å¦åªæ”¶åˆ°ä¸€å°é‚®ä»¶ï¼ˆä¸é‡å¤ï¼‰"

# æ¸…ç†æµ‹è¯•æ–‡ä»¶
rm -f "$TEST_ZIP" "/tmp/test_content.txt"
